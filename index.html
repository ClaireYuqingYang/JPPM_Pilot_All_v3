<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>X News Feed</title>
    <style>
      * { margin: 0; padding: 0; box-sizing: border-box; }
      body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; background: #000; color: #e7e9ea; }
      .x-layout {
        display: flex;
        flex-direction: row;
        flex-wrap: nowrap;
        justify-content: center;
        align-items: flex-start;
        min-height: 100vh;
        background: #000;
        width: 100vw;
        height: 100vh;
        overflow-x: auto;
      }
      .sidebar-left {
        width: 250px;
        min-width: 250px;
        max-width: 250px;
        background: #000;
        border-right: 1px solid #2f3336;
        display: flex;
        flex-direction: column;
        align-items: flex-end;
        padding: 8px 0 4px 0;
        height: 92vh;
        position: sticky;
        top: 0;
        z-index: 100;
      }
      .x-logo-main {
        font-size: 2.2rem;
        font-weight: 900;
        color: #fff;
        margin-bottom: 24px;
        align-self: flex-start;
        padding-left: 32px;
        cursor: pointer;
      }
      .x-nav-vertical {
        display: flex;
        flex-direction: column;
        gap: 2px;
        width: 100%;
      }
      .x-nav-vertical .nav-item {
        display: flex;
        align-items: center;
        gap: 18px;
        font-size: 1.18rem;
        color: #e7e9ea;
        font-weight: 500;
        padding: 12px 28px 12px 32px;
        border-radius: 32px;
        cursor: pointer;
        transition: background 0.18s;
        text-decoration: none;
      }
      .x-nav-vertical .nav-item.active, .x-nav-vertical .nav-item:hover {
        background: #16181c;
        color: #1d9bf0;
        font-weight: 700;
      }
      .post-btn {
        margin: 18px 0 16px 0;
        width: 80%;
        align-self: center;
        background: #181818;
        color: #fff;
        border: none;
        border-radius: 32px;
        font-size: 1.1rem;
        font-weight: 700;
        padding: 12px 0;
        cursor: pointer;
        transition: background 0.18s;
      }
      .post-btn:hover {
        background: #222;
      }
      .account-mini {
        display: flex;
        align-items: center;
        gap: 10px;
        margin-top: auto;
        padding: 10px 16px 10px 16px;
        border-radius: 32px;
        background: #16181c;
        width: 90%;
        align-self: flex-start;
        cursor: pointer;
      }
      .account-mini .avatar {
        width: 40px;
        height: 40px;
        border-radius: 50%;
      }
      .account-info {
        display: flex;
        flex-direction: column;
        line-height: 1.1;
      }
      .account-name {
        font-weight: 700;
        color: #e7e9ea;
        font-size: 15px;
      }
      .account-handle {
        color: #71767b;
        font-size: 14px;
      }
      .account-more {
        margin-left: auto;
        color: #71767b;
        font-size: 1.5rem;
      }
      .main-content {
        width: 680px;
        min-width: 0;
        background: #000;
        min-height: 92vh;
        border-right: 1px solid #2f3336;
        display: flex;
        flex-direction: column;
        align-items: stretch;
        flex-shrink: 1;
        margin-left: 0;
        margin-right: 0;
        overflow-x: auto;
        height: 92vh;
      }
      .topbar {
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 12px 20px 0 20px;
        background: #000;
        position: sticky;
        top: 0;
        z-index: 10;
      }
      .search-bar-main {
        display: flex;
        align-items: center;
        background: #16181c;
        border: 1px solid #2f3336;
        border-radius: 32px;
        padding: 8px 16px;
        width: 80%;
        color: #e7e9ea;
      }
      .search-bar-main input {
        background: transparent;
        border: none;
        outline: none;
        color: #e7e9ea;
        font-size: 1rem;
        width: 100%;
        margin-left: 8px;
      }
      .search-icon {
        font-size: 1.2rem;
        color: #71767b;
      }
      .settings-icon {
        font-size: 1.4rem;
        color: #71767b;
        cursor: pointer;
        padding: 8px;
        border-radius: 50%;
        transition: background 0.18s;
      }
      .settings-icon:hover {
        background: #222;
        color: #1d9bf0;
      }
      .tabs {
        display: flex;
        border-bottom: 1.5px solid #2f3336;
        margin-top: 8px;
        background: #000;
      }
      .tab {
        flex: 1;
        text-align: center;
        padding: 16px 0 12px 0;
        font-size: 1.1rem;
        font-weight: 600;
        color: #71767b;
        cursor: pointer;
        border-bottom: 2.5px solid transparent;
        transition: color 0.18s, border-color 0.18s;
      }
      .tab.active {
        color: #1d9bf0;
        border-bottom: 2.5px solid #1d9bf0;
        font-weight: 700;
      }
      .section-header {
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 16px 20px 0 20px;
        font-size: 1.2rem;
        font-weight: 700;
        color: #e7e9ea;
      }
      .section-title-main {
        font-size: 1.25rem;
        font-weight: 700;
      }
      .section-arrow, .section-more {
        color: #71767b;
        font-size: 1.3rem;
        margin-left: 12px;
        cursor: pointer;
      }
      .feed-list {
        display: flex;
        flex-direction: column;
        gap: 16px;
        padding: 12px 0 0 0;
      }
      .tweet-card {
        background: #16181c;
        border-radius: 16px;
        padding: 16px 20px 12px 20px;
        box-shadow: none;
        border: 1px solid #2f3336;
        display: flex;
        flex-direction: column;
        gap: 10px;
        transition: filter 0.2s;
      }
      .tweet-card.filtered {
        position: relative;
        pointer-events: none;
        user-select: none;
        filter: brightness(0.6) grayscale(0.2);
      }
      .tweet-card.filtered::after {
        content: "";
        position: absolute;
        top: 0; left: 0; right: 0; bottom: 0;
        background: rgba(0,0,0,0.6);
        border-radius: 16px;
        pointer-events: none;
        z-index: 2;
      }
      .tweet-card.filtered:hover {
        filter: none;
        pointer-events: auto;
        user-select: auto;
      }
      .tweet-card.filtered:hover::after {
        background: none;
      }
      .tweet-header {
        display: flex;
        align-items: center;
        gap: 8px;
        font-size: 15px;
      }
      .tweet-header .avatar {
        width: 40px;
        height: 40px;
        border-radius: 50%;
        margin-right: 8px;
      }
      .tweet-username {
        font-weight: 700;
        color: #e7e9ea;
        margin-right: 4px;
      }
      .verified {
        color: #1d9bf0;
        font-size: 1rem;
        margin-left: 2px;
      }
      .tweet-handle, .tweet-time, .tweet-dot {
        color: #71767b;
        font-weight: 400;
        font-size: 15px;
      }
      .tweet-actions-right {
        margin-left: auto;
        color: #71767b;
        font-size: 1.2rem;
        cursor: pointer;
        display: flex;
        gap: 8px;
      }
      .tweet-body {
        color: #e7e9ea;
        font-size: 15px;
        line-height: 1.5;
        margin-left: 48px;
      }
      .tweet-link {
        color: #1d9bf0;
        text-decoration: none;
        margin-left: 4px;
      }
      .tweet-media {
        margin-left: 48px;
        margin-top: 8px;
        border-radius: 16px;
        overflow: hidden;
        background: #222;
        position: relative;
      }
      .tweet-media img {
        width: 100%;
        border-radius: 16px;
        display: block;
      }
      .media-source {
        color: #71767b;
        font-size: 13px;
        margin: 4px 0 0 0;
        padding: 0 0 4px 0;
      }
      .tweet-actionbar {
        display: flex;
        align-items: center;
        justify-content: space-between;
        margin-left: 48px;
        margin-top: 8px;
        gap: 0;
        position: relative;
      }
      .tweet-actionbar .action {
        color: #71767b;
        font-size: 15px;
        display: flex;
        align-items: center;
        gap: 4px;
        cursor: pointer;
        transition: color 0.18s;
        border-radius: 20px;
        padding: 4px 10px;
        margin-right: 0;
      }
      .tweet-actionbar .action-group {
        display: flex;
        align-items: center;
      }
      .tweet-actionbar .action-group.last {
        gap: 8px;
        margin-left: 0;
        margin-right: 0;
      }
      }
      .tweet-actionbar .action {
        color: #71767b;
        font-size: 15px;
        display: flex;
        align-items: center;
        gap: 4px;
        cursor: pointer;
        transition: color 0.18s;
        border-radius: 20px;
        padding: 4px 10px;
      }
      .tweet-actionbar .action:hover {
        background: #222;
        color: #1d9bf0;
      }
      .tweet-actionbar .action-spacer {
        display: none;
      }
      /* .sidebar-right removed as per user request */
      .who-to-follow-card {
        background: #16181c;
        border-radius: 16px;
        border: 1px solid #2f3336;
        padding: 16px 16px 8px 16px;
        display: flex;
        flex-direction: column;
        gap: 10px;
      }
      .who-title {
        font-size: 1.1rem;
        font-weight: 700;
        color: #e7e9ea;
        margin-bottom: 8px;
      }
      .who-item {
        display: flex;
        align-items: center;
        gap: 10px;
        padding: 6px 0;
      }
      .who-item .avatar {
        width: 40px;
        height: 40px;
        border-radius: 50%;
      }
      .who-info {
        display: flex;
        flex-direction: column;
        line-height: 1.1;
      }
      .who-name {
        font-weight: 700;
        color: #e7e9ea;
        font-size: 15px;
      }
      .who-handle {
        color: #71767b;
        font-size: 14px;
      }
      .follow-btn {
        margin-left: auto;
        background: #000;
        color: #fff;
        border: 1px solid #2f3336;
        border-radius: 32px;
        font-size: 1rem;
        font-weight: 700;
        padding: 6px 18px;
        cursor: pointer;
        transition: background 0.18s, color 0.18s;
        height: 32px;
      }
      .follow-btn:hover {
        background: #222;
        color: #1d9bf0;
      }
      .show-more {
        color: #1d9bf0;
        font-size: 15px;
        margin-top: 4px;
        cursor: pointer;
        text-decoration: none;
        align-self: flex-start;
      }
      .footer-links {
        color: #71767b;
        font-size: 13px;
        margin-top: 24px;
        line-height: 1.5;
        word-break: break-all;
      }
      .footer-links a {
        color: #71767b;
        text-decoration: none;
        margin: 0 2px;
        cursor: pointer;
      }
      /* 保证右侧sidebar-right在所有分辨率下都显示 */
      /* @media (max-width: 1280px) {
        .sidebar-right { display: none; }
      } */
      @media (max-width: 1024px) {
        .sidebar-left { display: none; }
        .main-content { border-right: none; margin-left: 0; }
      }
      @media (max-width: 768px) {
        .sidebar-left { display: none; }
        .main-content { width: 100vw; min-width: 0; margin-left: 0; }
      }
    </style>
</head>
<body>

<div class="x-layout">
  <!-- Sidebar Left -->
  <aside class="sidebar-left">
    <div class="x-logo-main">𝕏</div>
    <nav class="x-nav-vertical">
      <a class="nav-item active"><span>🏠</span> Home</a>
      <a class="nav-item"><span>🔍</span> Explore</a>
      <a class="nav-item"><span>🔔</span> Notifications</a>
      <a class="nav-item"><span>✉️</span> Messages</a>
      <a class="nav-item"><span>🤖</span> Grok</a>
      <a class="nav-item"><span>👥</span> Communities</a>
      <a class="nav-item"><span>💎</span> Premium</a>
      <a class="nav-item"><span>🏢</span> Verified Orgs</a>
      <a class="nav-item"><span>👤</span> Profile</a>
      <a class="nav-item"><span>⋯</span> More</a>
    </nav>
    <button class="post-btn">Post</button>
    <div class="account-mini">
      <img class="avatar" src="https://abs.twimg.com/sticky/default_profile_images/default_profile_400x400.png" alt="avatar">
      <div class="account-info">
        <div class="account-name">Claire Yang <span class="verified">✔️</span></div>
        <div class="account-handle">@ClaireYang11066</div>
      </div>
      <span class="account-more">⋯</span>
    </div>
  </aside>
  <!-- Main Content -->
  <main class="main-content">
    <div class="topbar">
      <div class="search-bar-main"><span class="search-icon">🔍</span><input type="text" placeholder="Search" /></div>
      <span class="settings-icon">⚙️</span>
    </div>
    <div class="feed-list" id="newsFeed">
      <!-- 多条post，含blur/filtered功能 -->
      <div class="tweet-card" data-type="news" data-emotional="false">
        <div class="tweet-header">
          <img class="avatar" src="https://abs.twimg.com/sticky/default_profile_images/default_profile_400x400.png" alt="avatar">
          <span class="tweet-username">Reuters <span class="verified">✔️</span></span>
          <span class="tweet-handle">@Reuters</span>
          <span class="tweet-dot">·</span>
          <span class="tweet-time">17m</span>
          <span class="tweet-actions-right">⋯</span>
        </div>
        <div class="tweet-body">Federal Reserve announces interest rate decision following two-day policy meeting. New rate set at 5.25% with gradual adjustments planned for next quarter.</div>
        <div class="tweet-media"><img src="https://placehold.co/680x340/222/fff?text=Image" alt="media"><div class="media-source">from economictimes.com</div></div>
        <div class="tweet-actionbar">
          <span class="action">💬 12</span>
          <span class="action">🔄 23</span>
          <span class="action">❤️ 359</span>
          <span class="action">👁️ 7k</span>
          <span class="action-group last">
            <span class="action">🔖</span>
            <span class="action">↗️</span>
          </span>
        </div>
      </div>
      <div class="tweet-card filtered" data-type="entertainment">
        <div class="tweet-header">
          <img class="avatar" src="https://abs.twimg.com/sticky/default_profile_images/default_profile_400x400.png" alt="avatar">
          <span class="tweet-username">Netflix</span>
          <span class="tweet-handle">@netflix</span>
          <span class="tweet-dot">·</span>
          <span class="tweet-time">28m</span>
          <span class="tweet-actions-right">⋯</span>
        </div>
        <div class="tweet-body">New season of Stranger Things dropping next month! 🎬✨ Here's your first look at what's coming...</div>
        <div class="tweet-media"><img src="https://placehold.co/680x340/222/fff?text=Image" alt="media"><div class="media-source">from netflix.com</div></div>
        <div class="tweet-actionbar">
          <span class="action">💬 5</span>
          <span class="action">🔄 29</span>
          <span class="action">❤️ 547</span>
          <span class="action">👁️ 5k</span>
          <span class="action-group last">
            <span class="action">🔖</span>
            <span class="action">↗️</span>
          </span>
        </div>
      </div>
      
      <div class="tweet-card" data-type="news" data-emotional="true">
        <div class="tweet-header">
          <img class="avatar" src="https://abs.twimg.com/sticky/default_profile_images/default_profile_400x400.png" alt="avatar">
          <span class="tweet-username">Breaking Politics</span>
          <span class="tweet-handle">@breakingpol</span>
          <span class="tweet-dot">·</span>
          <span class="tweet-time">9m</span>
          <span class="tweet-actions-right"> ⋯</span>
        </div>
        <div class="tweet-body">🚨 BREAKING: EXPLOSIVE new revelations SHOCK the nation! Officials are OUTRAGED and FURIOUS about DEVASTATING developments that will DESTROY everything! This is UNBELIEVABLE! 😱🔥</div>
        <div class="tweet-media"><img src="https://placehold.co/680x340/222/fff?text=Image" alt="media"><div class="media-source">from breakingnews.com</div></div>
        <div class="tweet-actionbar">
          <span class="action">💬 11</span>
          <span class="action">🔄 32</span>
          <span class="action">❤️ 602</span>
          <span class="action">👁️ 8k</span>
          <span class="action-group last">
            <span class="action">🔖</span>
            <span class="action">↗️</span>
          </span>
        </div>
      </div>
      <div class="tweet-card" data-type="news" data-emotional="false">
        <div class="tweet-header">
          <img class="avatar" src="https://abs.twimg.com/sticky/default_profile_images/default_profile_400x400.png" alt="avatar">
          <span class="tweet-username">BBC News</span>
          <span class="tweet-handle">@BBCNews</span>
          <span class="tweet-dot">·</span>
          <span class="tweet-time">22m</span>
          <span class="tweet-actions-right"> ⋯</span>
        </div>
        <div class="tweet-body">Scientists discover new species of deep-sea jellyfish in the Pacific Ocean. The creature glows in the dark and has unique tentacle patterns.</div>
        <div class="tweet-media"><img src="https://placehold.co/680x340/222/fff?text=Image" alt="media"><div class="media-source">from bbc.com</div></div>
        <div class="tweet-actionbar">
          <span class="action">💬 3</span>
          <span class="action">🔄 32</span>
          <span class="action">❤️ 511</span>
          <span class="action">👁️ 6k</span>
          <span class="action-group last">
            <span class="action">🔖</span>
            <span class="action">↗️</span>
          </span>
        </div>
      </div>
      <div class="tweet-card filtered" data-type="entertainment">
        <div class="tweet-header">
          <img class="avatar" src="https://abs.twimg.com/sticky/default_profile_images/default_profile_400x400.png" alt="avatar">
          <span class="tweet-username">Marvel Studios</span>
          <span class="tweet-handle">@MarvelStudios</span>
          <span class="tweet-dot">·</span>
          <span class="tweet-time">13m</span>
          <span class="tweet-actions-right"> ⋯</span>
        </div>
        <div class="tweet-body">The new Avengers trailer is here! Watch Earth's mightiest heroes assemble once again. #Avengers</div>
        <div class="tweet-media"><img src="https://placehold.co/680x340/222/fff?text=Image" alt="media"><div class="media-source">from marvel.com</div></div>
        <div class="tweet-actionbar">
          <span class="action">💬 9</span>
          <span class="action">🔄 19</span>
          <span class="action">❤️ 448</span>
          <span class="action">👁️ 7k</span>
          <span class="action-group last">
            <span class="action">🔖</span>
            <span class="action">↗️</span>
          </span>
        </div>
      </div>
      <div class="tweet-card" data-type="news" data-emotional="false">
        <div class="tweet-header">
          <img class="avatar" src="https://abs.twimg.com/sticky/default_profile_images/default_profile_400x400.png" alt="avatar">
          <span class="tweet-username">TechCrunch</span>
          <span class="tweet-handle">@TechCrunch</span>
          <span class="tweet-dot">·</span>
          <span class="tweet-time">31m</span>
          <span class="tweet-actions-right"> ⋯</span>
        </div>
        <div class="tweet-body">Apple unveils new MacBook Pro lineup with M3 chips, improved battery life, and brighter displays.</div>
        <div class="tweet-media"><img src="https://placehold.co/680x340/222/fff?text=Image" alt="media"><div class="media-source">from techcrunch.com</div></div>
        <div class="tweet-actionbar">
          <span class="action">💬 13</span>
          <span class="action">🔄 20</span>
          <span class="action">❤️ 407</span>
          <span class="action">👁️ 9k</span>
          <span class="action-group last">
            <span class="action">🔖</span>
            <span class="action">↗️</span>
          </span>
        </div>
      </div>
    </div>
      <!-- 可继续添加更多tweet-card结构 -->
    </div>
  </main>
  <!-- Sidebar Right removed as per user request -->
</div>
<script>
    // ====== 通用变量和日志 ======
    let step = 1;
    let timer = 0;
    let interval = null;
    let currentPage1 = 1;
    const TWEETS_PER_PAGE = 2;

    // 日志
    const userLogs = [];
    const actionCounts = {
        toggle: 0, like: 0, comment: 0, retweet: 0, stats: 0, nextPage: 0, prevPage: 0
    };
    const participantId = ""; // participant ID prompt removed
    let startTime = new Date();
    let endTime = null;

    function logAction(action, detail = {}) {
        const ts = new Date();
        userLogs.push({ action, detail, timestamp: ts.toISOString() });
        endTime = ts;
        if (action === 'toggle_mode') actionCounts.toggle++;
        if (action === 'click_like') actionCounts.like++;
        if (action === 'click_comment' || action === 'send_comment') actionCounts.comment++;
        if (action === 'click_retweet') actionCounts.retweet++;
        if (action === 'click_stats') actionCounts.stats++;
        if (action === 'next_page') actionCounts.nextPage++;
        if (action === 'prev_page') actionCounts.prevPage++;
        // console.log('User Action:', action, detail, ts.toLocaleTimeString());
    }

    function exportLogsAsCSV() {
        const header = [
            'participantId', 'startTime', 'endTime', 'actionCount',
            'toggleCount', 'likeCount', 'commentCount', 'retweetCount', 'statsCount', 'nextPageCount', 'prevPageCount',
            'actions'
        ];
        const row = [
            participantId,
            startTime.toISOString(),
            endTime ? endTime.toISOString() : '',
            userLogs.length,
            actionCounts.toggle,
            actionCounts.like,
            actionCounts.comment,
            actionCounts.retweet,
            actionCounts.stats,
            actionCounts.nextPage,
            actionCounts.prevPage,
            JSON.stringify(userLogs).replace(/"/g, '""')
        ];
        const csv = [header.join(','), row.join(',')].join('\n');
        const blob = new Blob([csv], {type: 'text/csv'});
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = `user_logs_${participantId}.csv`;
        a.click();
        URL.revokeObjectURL(url);
    }

    // ====== 阶段切换与计时 ======
    function startStepTimer(stepNum, minSec, maxSec, nextCallback) {
        timer = 0;
        const btn = document.getElementById(stepNum === 1 ? 'nextBtn' : 'finishBtn');
        const timerSpan = document.getElementById(stepNum === 1 ? 'timer1' : 'timer2');
        btn.disabled = true;
        timerSpan.textContent = `You can proceed in ${minSec} seconds`;
        interval = setInterval(() => {
            timer++;
            if (timer < minSec) {
                btn.disabled = true;
                timerSpan.textContent = `You can proceed in ${minSec-timer} seconds`;
            } else {
                btn.disabled = false;
                timerSpan.textContent = `You can proceed now. Auto-advance in ${maxSec-timer} seconds`;
            }
            if (timer >= maxSec) {
                clearInterval(interval);
                nextCallback();
            }
        }, 1000);
    }




function showThankYouModal() {
    if (document.getElementById('thankYouModalOverlay')) return;
    const overlay = document.createElement('div');
    overlay.className = 'comment-modal-overlay';
    overlay.id = 'thankYouModalOverlay';
    overlay.innerHTML = `
        <div class="comment-modal" style="max-width:800px;text-align:center;">
            <div style="font-size:2rem;font-weight:700;margin-bottom:10px;">Thank you for participating! </div>
            <div style="font-size:1.1rem;color:#e7e9ea;margin-bottom:18px;">Please press <b>F10</b> to proceed.</div>
        </div>
    `;
    document.body.appendChild(overlay);
    document.body.style.overflow = 'hidden';
    // Optionally, you can add a button to close this modal if needed
}

    document.addEventListener('DOMContentLoaded', function() {
        // 直接进入主界面，无welcome弹窗
        updatePagination(1);
        logAction('page_load_step1');
        startStepTimer(1, 2, 300, finishExperiment);
    });

    // ====== 分页 ======
    function updatePagination() {
        let tweets = Array.from(document.querySelectorAll('#newsFeed .tweet'));
        let page = currentPage1;
        let pageIndicator = document.getElementById('pageIndicator1');
        let prevBtn = document.getElementById('prevPageBtn1');
        let nextBtn = document.getElementById('nextPageBtn1');
        const totalPages = Math.max(1, Math.ceil(tweets.length / TWEETS_PER_PAGE));
        currentPage1 = Math.min(currentPage1, totalPages);
        tweets.forEach(t => t.style.display = 'none');
        const start = (currentPage1 - 1) * TWEETS_PER_PAGE;
        const end = start + TWEETS_PER_PAGE;
        tweets.slice(start, end).forEach(t => t.style.display = '');
        pageIndicator.textContent = `${currentPage1} / ${totalPages}`;
        prevBtn.disabled = currentPage1 === 1;
        nextBtn.disabled = currentPage1 === totalPages;
    }
    function nextPage() {
        let tweets = Array.from(document.querySelectorAll('#newsFeed .tweet'));
        const totalPages = Math.max(1, Math.ceil(tweets.length / TWEETS_PER_PAGE));
        if (currentPage1 < totalPages) {
            currentPage1++;
            updatePagination();
            logAction('next_page', {step: 1, page: currentPage1});
        }
    }
    function prevPage() {
        if (currentPage1 > 1) {
            currentPage1--;
            updatePagination();
            logAction('prev_page', {step: 1, page: currentPage1});
        }
    }

    // ====== Step2 Toggle模式 ======


    // ====== 互动功能（两步都支持）======
    function getFeedSelector() {
        return '#newsFeed';
    }
    document.addEventListener('DOMContentLoaded', function() {
        document.querySelector('#newsFeed').addEventListener('click', function(e) {
            handleFeedClick(e);
        });
    });
    function handleFeedClick(e) {
        const btn = e.target.closest('.action-btn');
        if (!btn) return;
        const action = btn.getAttribute('data-action');
        const tweetElem = btn.closest('.tweet');
        const tweetIndex = Array.from(document.querySelectorAll('#newsFeed .tweet')).indexOf(tweetElem);
        if (action === 'retweet' || action === 'like') {
            btn.classList.toggle('active');
            logAction('click_' + action, {step: 1, tweetIndex});
        } else if (action === 'comment') {
            btn.classList.add('active');
            logAction('click_comment', {step: 1, tweetIndex});
            showCommentModal(btn, tweetIndex);
        } else if (action === 'stats') {
            btn.classList.add('active');
            logAction('click_stats', {step: 1, tweetIndex});
            showViewsModal(btn);
        }
    }
    // 评论弹窗
    function showCommentModal(btn, tweetIndex) {
        if (document.getElementById('commentModalOverlay')) return;
        const overlay = document.createElement('div');
        overlay.className = 'comment-modal-overlay';
        overlay.id = 'commentModalOverlay';
        overlay.innerHTML = `
            <div class="comment-modal">
                <div style="font-weight:600;font-size:16px;">Add a comment</div>
                <textarea id="commentInput" placeholder="Write your comment..."></textarea>
                <div class="modal-actions">
                    <button class="cancel" onclick="closeCommentModal()">Cancel</button>
                    <button onclick="sendComment(${tweetIndex})">Send</button>
                </div>
            </div>
        `;
        document.body.appendChild(overlay);
        overlay.addEventListener('click', function(e) {
            if (e.target === overlay) {
                closeCommentModal();
            }
        });
        window._activeCommentBtn = btn;
    }
    function closeCommentModal() {
        const overlay = document.getElementById('commentModalOverlay');
        if (overlay) overlay.remove();
        if (window._activeCommentBtn) {
            window._activeCommentBtn.classList.remove('active');
            window._activeCommentBtn = null;
        }
    }
function sendComment(tweetIndex) {
  const textarea = document.getElementById('commentInput');
  let comment = (textarea.value || '').trim()
    .replace(/[\u0000-\u001F\u2028\u2029]/g, ' ')
    .slice(0, 800);

  if (comment) {
    // 记录日志
    logAction('send_comment', { step, tweetIndex, comment });

    // 通知父页面（Qualtrics）去弹 toast
    try {
      window.parent.postMessage({
        type:  'ff_log',
        action:'send_comment',
        ts:    new Date().toISOString(),
        detail:{ comment }
      }, '*');
    } catch (e) { /* 忽略跨域异常 */ }

    // 关闭评论弹窗 & 清空输入
    closeCommentModal();
    textarea.value = '';
  } else {
    textarea.focus();
  }
}

          

// 通知父页面（Qualtrics）触发 toast
try {
  window.parent.postMessage({
    type: 'ff_log',
    action: 'send_comment',
    ts: new Date().toISOString(),
    detail: { comment: comment }
  }, '*');
} catch (e) {}
            closeCommentModal();
        } else {
            textarea.focus();
        }
    }
    // Views弹窗
    function showViewsModal(btn) {
        if (document.getElementById('viewsModalOverlay')) return;
        const overlay = document.createElement('div');
        overlay.className = 'comment-modal-overlay';
        overlay.id = 'viewsModalOverlay';
        overlay.innerHTML = `
            <div class="comment-modal">
                <div style="font-weight:700;font-size:22px;text-align:center;">Views</div>
                <div style="margin-top:12px;text-align:center;font-size:15px;color:#e7e9ea;">Times this post was seen.</div>
                <div class="modal-actions" style="justify-content:center;margin-top:20px;">
                    <button onclick="closeViewsModal()">Close</button>
                </div>
            </div>
        `;
        document.body.appendChild(overlay);
        overlay.addEventListener('click', function(e) {
            if (e.target === overlay) {
                closeViewsModal();
            }
        });
        window._activeViewsBtn = btn;
    }

    function closeViewsModal() {
        const overlay = document.getElementById('viewsModalOverlay');
        if (overlay) overlay.remove();
        if (window._activeViewsBtn) {
            window._activeViewsBtn.classList.remove('active');
            window._activeViewsBtn = null;
        }
    }


</script>
    <!-- 放在 body 里面就行 -->
<div id="toast" style="position:fixed;left:50%;bottom:24px;transform:translateX(-50%);
padding:10px 14px;border-radius:10px;background:#111;color:#fff;
box-shadow:0 4px 16px rgba(0,0,0,.25);display:none;z-index:9999">
</div>
</body>
</html>
